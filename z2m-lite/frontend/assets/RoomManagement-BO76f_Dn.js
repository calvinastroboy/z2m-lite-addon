import{j as s}from"./ui-BNQquHvV.js";import{c as D,r as d}from"./vendor-DN6e53jq.js";import{e as n,u as b,t as c}from"./index-Cd7pvFwH.js";import{e as _,P as S,h as A,i as I}from"./icons-Cg0FTVUT.js";import"./i18n-BzK7rx8x.js";function F(){const g=D(),m=n(e=>e.rooms),x=n(e=>e.deviceRoomAssignments),h=n(e=>e.addRoom),f=n(e=>e.assignDevice),j=n(e=>e.unassignDevice),N=b(e=>e.allIds),k=b(e=>e.byId),[u,i]=d.useState(!1),[o,v]=d.useState(""),[a,w]=d.useState(null),p=N.map(e=>k[e]).filter(e=>!!e&&e.type!=="coordinator"),y=()=>{o.trim()&&(h({id:Date.now().toString(),name:o.trim(),icon:"home",deviceIds:[],createdAt:Date.now(),updatedAt:Date.now()}),c.success(`房間「${o}」已新增`),v(""),i(!1))},C=n(e=>e.deleteRoom),R=(e,t)=>{confirm(`確定要刪除房間「${t}」？`)&&(C(e),c.success(`房間「${t}」已刪除`))},z=e=>p.filter(t=>x[t.friendly_name]===e),l=()=>p.filter(e=>!x[e.friendly_name]);return s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between px-5 pb-4 pt-2",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("button",{onClick:()=>g("/settings"),className:"flex h-8 w-8 items-center justify-center rounded-full",style:{background:"var(--bg-card)",minHeight:"auto",minWidth:"auto"},children:s.jsx(_,{size:18})}),s.jsx("h1",{className:"text-[24px] font-bold",children:"房間管理"})]}),s.jsx("button",{onClick:()=>i(!0),className:"flex h-10 w-10 items-center justify-center rounded-full border transition-all active:scale-[0.92]",style:{background:"var(--bg-card)",borderColor:"var(--z2m-border)"},children:s.jsx(S,{size:18})})]}),u&&s.jsxs("div",{className:"mx-5 mb-4 rounded-2xl border p-4",style:{background:"var(--bg-card)",borderColor:"var(--z2m-border)"},children:[s.jsx("div",{className:"mb-3 text-sm font-medium",children:"新增房間"}),s.jsx("input",{type:"text",value:o,onChange:e=>v(e.target.value),placeholder:"房間名稱（如：客廳、臥室）",className:"mb-3 w-full rounded-xl border px-4 py-3 text-sm",style:{background:"var(--bg-elevated)",borderColor:"var(--z2m-border)",color:"var(--text-primary)"},onKeyDown:e=>e.key==="Enter"&&y(),autoFocus:!0}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{onClick:()=>i(!1),className:"flex-1 rounded-xl py-2.5 text-sm",style:{background:"var(--bg-elevated)",color:"var(--text-secondary)"},children:"取消"}),s.jsx("button",{onClick:y,className:"flex-1 rounded-xl py-2.5 text-sm font-semibold",style:{background:"var(--z2m-accent)",color:"#000"},children:"新增"})]})]}),s.jsx("div",{className:"space-y-3 px-5 pb-4",children:m.map(e=>{const t=z(e.id);return s.jsxs("div",{className:"rounded-2xl border p-4",style:{background:"var(--bg-card)",borderColor:"var(--z2m-border)"},children:[s.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("div",{className:"text-[15px] font-semibold",children:e.name}),s.jsxs("div",{className:"text-[12px]",style:{color:"var(--text-tertiary)"},children:[t.length," 個設備"]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:()=>w(a===e.id?null:e.id),className:"rounded-lg px-3 py-1.5 text-[12px] font-medium",style:{background:a===e.id?"var(--z2m-accent)":"var(--bg-elevated)",color:a===e.id?"#000":"var(--text-secondary)",minHeight:"auto",minWidth:"auto"},children:a===e.id?"完成":"分配設備"}),s.jsx("button",{onClick:()=>R(e.id,e.name),className:"flex h-8 w-8 items-center justify-center rounded-full",style:{color:"var(--text-tertiary)",minHeight:"auto",minWidth:"auto"},children:s.jsx(A,{size:16})})]})]}),t.length>0&&s.jsx("div",{className:"flex flex-wrap gap-1.5",children:t.map(r=>s.jsxs("span",{className:"flex items-center gap-1 rounded-lg px-2.5 py-1 text-[11px]",style:{background:"var(--bg-elevated)",color:"var(--text-secondary)"},children:[r.friendly_name,a===e.id&&s.jsx(I,{size:12,className:"cursor-pointer",style:{color:"var(--z2m-red)"},onClick:()=>j(r.friendly_name)})]},r.friendly_name))}),a===e.id&&s.jsxs("div",{className:"mt-3 border-t pt-3",style:{borderColor:"var(--z2m-border)"},children:[s.jsx("div",{className:"mb-2 text-[11px]",style:{color:"var(--text-tertiary)"},children:"點擊設備加入此房間："}),s.jsxs("div",{className:"flex flex-wrap gap-1.5",children:[l().map(r=>s.jsxs("span",{className:"cursor-pointer rounded-lg px-2.5 py-1 text-[11px] transition-colors",style:{background:"var(--bg-primary)",color:"var(--text-secondary)",border:"1px dashed var(--z2m-border)"},onClick:()=>{f(r.friendly_name,e.id),c.success(`${r.friendly_name} → ${e.name}`)},children:["+ ",r.friendly_name]},r.friendly_name)),l().length===0&&s.jsx("span",{className:"text-[11px]",style:{color:"var(--text-tertiary)"},children:"所有設備已分配"})]})]})]},e.id)})}),l().length>0&&s.jsxs("div",{className:"px-5 pb-6",children:[s.jsxs("div",{className:"mb-2 text-[13px] font-medium",style:{color:"var(--text-tertiary)"},children:["未分配設備（",l().length,"）"]}),s.jsx("div",{className:"flex flex-wrap gap-1.5",children:l().map(e=>s.jsx("span",{className:"rounded-lg px-2.5 py-1 text-[11px]",style:{background:"var(--bg-card)",color:"var(--text-tertiary)",border:"1px solid var(--z2m-border)"},children:e.friendly_name},e.friendly_name))})]}),m.length===0&&!u&&s.jsx("div",{className:"py-12 text-center text-sm",style:{color:"var(--text-tertiary)"},children:"尚無房間，點擊 ➕ 新增"})]})}export{F as RoomManagement};
//# sourceMappingURL=RoomManagement-BO76f_Dn.js.map
