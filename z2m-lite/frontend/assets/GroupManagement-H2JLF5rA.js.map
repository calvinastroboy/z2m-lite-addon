{"version":3,"file":"GroupManagement-H2JLF5rA.js","sources":["../../src/hooks/useGroups.ts","../../src/pages/GroupManagement.tsx"],"sourcesContent":["// Groups hook for Z2M Lite\n// T039: Group management and state aggregation\n// T140: controlGroup via deviceService\n// T141: Group state aggregation from device states\n// T143: Group member add/remove via deviceService\n// T145: Recalculate group state when member device changes\n// T146: Update group average brightness when members change\n\nimport { useCallback, useMemo } from 'react';\nimport { useGroupStore } from '../stores/groupStore';\nimport { useDeviceStore } from '../stores/deviceStore';\nimport { deviceService } from '../services/deviceService';\nimport type { GroupAggregateState } from '../types/group';\n\nexport function useGroups() {\n  const groupStore = useGroupStore();\n  const devicesById = useDeviceStore((state) => state.byId);\n\n  // T141, T145: Build device state map from current device states for aggregate calculation\n  const deviceStates = useMemo(() => {\n    const states: Record<string, { state?: 'ON' | 'OFF'; brightness?: number }> = {};\n    for (const [, device] of Object.entries(devicesById)) {\n      states[device.ieee_address] = {\n        state: device.state?.state,\n        brightness: device.state?.brightness,\n      };\n    }\n    return states;\n  }, [devicesById]);\n\n  // T141, T145: Get aggregate state for a group, recalculated when device states change\n  const getAggregateState = useCallback(\n    (groupId: string | number): GroupAggregateState => {\n      return groupStore.getGroupAggregateState(groupId, deviceStates);\n    },\n    [groupStore, deviceStates]\n  );\n\n  // T146: Get average brightness for a group, recalculated when device states change\n  const getAverageBrightness = useCallback(\n    (groupId: string | number): number | undefined => {\n      return groupStore.getGroupAverageBrightness(groupId, deviceStates);\n    },\n    [groupStore, deviceStates]\n  );\n\n  // T140: Control group via deviceService\n  const controlGroup = useCallback(\n    async (groupName: string, command: { state?: 'ON' | 'OFF'; brightness?: number }) => {\n      await deviceService.controlGroup(groupName, command);\n    },\n    []\n  );\n\n  // T139: Create group via deviceService\n  const createGroup = useCallback(async (name: string) => {\n    await deviceService.createGroup(name);\n  }, []);\n\n  // Delete group via deviceService\n  const deleteGroup = useCallback(async (groupName: string) => {\n    await deviceService.deleteGroup(groupName);\n  }, []);\n\n  // T143: Add member to group via deviceService\n  const addMemberToGroup = useCallback(\n    async (groupName: string, deviceName: string) => {\n      await deviceService.addGroupMember(groupName, deviceName);\n    },\n    []\n  );\n\n  // T143: Remove member from group via deviceService\n  const removeMemberFromGroup = useCallback(\n    async (groupName: string, deviceName: string) => {\n      await deviceService.removeGroupMember(groupName, deviceName);\n    },\n    []\n  );\n\n  return {\n    groups: groupStore.groups,\n    getGroup: groupStore.getGroup,\n    getAggregateState,\n    getAverageBrightness,\n    controlGroup,\n    createGroup,\n    deleteGroup,\n    addMemberToGroup,\n    removeMemberFromGroup,\n  };\n}\n","import { useState } from 'react';\nimport { Plus, Trash2, ChevronLeft, X, UserPlus } from 'lucide-react';\nimport { useNavigate } from 'react-router-dom';\nimport { useGroups } from '../hooks/useGroups';\nimport { useDeviceStore } from '../stores/deviceStore';\nimport { useGroupStore } from '../stores/groupStore';\nimport { deviceService } from '../services/deviceService';\nimport type { Device } from '../types/device';\nimport { toast } from 'sonner';\n\nexport function GroupManagement() {\n  const navigate = useNavigate();\n  const { groups, getAggregateState } = useGroups();\n  const devicesById = useDeviceStore((s) => s.byId);\n  const allIds = useDeviceStore((s) => s.allIds);\n  const [showCreate, setShowCreate] = useState(false);\n  const [newGroupName, setNewGroupName] = useState('');\n  const [editingGroup, setEditingGroup] = useState<string | null>(null); // group friendly_name\n\n  // All non-coordinator devices\n  const allDevices: Device[] = allIds\n    .map((id) => devicesById[id])\n    .filter((d): d is Device => !!d && d.type !== 'coordinator');\n\n  const handleCreateGroup = async () => {\n    if (!newGroupName.trim()) return;\n    try {\n      await deviceService.createGroup(newGroupName.trim());\n      toast.success(`群組「${newGroupName}」已建立`);\n      setNewGroupName('');\n      setShowCreate(false);\n    } catch {\n      toast.error('建立群組失敗');\n    }\n  };\n\n  const handleDeleteGroup = async (groupName: string) => {\n    if (!confirm(`確定要刪除群組「${groupName}」？`)) return;\n    try {\n      await deviceService.deleteGroup(groupName);\n      toast.success(`群組「${groupName}」已刪除`);\n    } catch {\n      toast.error('刪除群組失敗');\n    }\n  };\n\n  const handleToggleGroup = async (groupName: string, currentState: string | undefined) => {\n    const newState = currentState === 'ON' ? 'OFF' : 'ON';\n    try {\n      await deviceService.controlGroup(groupName, { state: newState as 'ON' | 'OFF' });\n    } catch {\n      toast.error('控制群組失敗');\n    }\n  };\n\n  const handleAddMember = async (groupName: string, device: Device) => {\n    // Optimistic: update local store immediately\n    const group = groups.find((g) => g.friendly_name === groupName);\n    if (group) {\n      const updatedMembers = [...group.members, { ieee_address: device.ieee_address, endpoint: 1 }];\n      useGroupStore.getState().updateGroup(group.id, { members: updatedMembers });\n    }\n    try {\n      await deviceService.addGroupMember(groupName, device.friendly_name);\n      toast.success(`${device.friendly_name} 已加入「${groupName}」`);\n    } catch {\n      // Rollback\n      if (group) {\n        useGroupStore.getState().updateGroup(group.id, { members: group.members });\n      }\n      toast.error('加入失敗');\n    }\n  };\n\n  const handleRemoveMember = async (groupName: string, device: Device) => {\n    // Optimistic: update local store immediately\n    const group = groups.find((g) => g.friendly_name === groupName);\n    if (group) {\n      const updatedMembers = group.members.filter((m) => m.ieee_address !== device.ieee_address);\n      useGroupStore.getState().updateGroup(group.id, { members: updatedMembers });\n    }\n    try {\n      await deviceService.removeGroupMember(groupName, device.friendly_name);\n      toast.success(`${device.friendly_name} 已從「${groupName}」移除`);\n    } catch {\n      // Rollback\n      if (group) {\n        useGroupStore.getState().updateGroup(group.id, { members: group.members });\n      }\n      toast.error('移除失敗');\n    }\n  };\n\n  const getMemberIeees = (group: (typeof groups)[0]): Set<string> => {\n    return new Set((group.members ?? []).map((m: { ieee_address: string }) => m.ieee_address));\n  };\n\n  return (\n    <div>\n      {/* Header */}\n      <div className=\"flex items-center justify-between px-5 pb-4 pt-2\">\n        <div className=\"flex items-center gap-3\">\n          <button onClick={() => navigate('/')} className=\"flex h-8 w-8 items-center justify-center rounded-full\"\n            style={{ background: 'var(--bg-card)', minHeight: 'auto', minWidth: 'auto' }}>\n            <ChevronLeft size={18} />\n          </button>\n          <h1 className=\"text-[24px] font-bold\">群組</h1>\n        </div>\n        <button\n          onClick={() => setShowCreate(true)}\n          className=\"flex h-10 w-10 items-center justify-center rounded-full border transition-all active:scale-[0.92]\"\n          style={{ background: 'var(--bg-card)', borderColor: 'var(--z2m-border)' }}\n        >\n          <Plus size={18} />\n        </button>\n      </div>\n\n      {/* Create Group Dialog */}\n      {showCreate && (\n        <div className=\"mx-5 mb-4 rounded-2xl border p-4\" style={{ background: 'var(--bg-card)', borderColor: 'var(--z2m-border)' }}>\n          <div className=\"mb-3 text-sm font-medium\">新增群組</div>\n          <input\n            type=\"text\"\n            value={newGroupName}\n            onChange={(e) => setNewGroupName(e.target.value)}\n            placeholder=\"群組名稱\"\n            className=\"mb-3 w-full rounded-xl border px-4 py-3 text-sm\"\n            style={{ background: 'var(--bg-elevated)', borderColor: 'var(--z2m-border)', color: 'var(--text-primary)' }}\n            onKeyDown={(e) => e.key === 'Enter' && handleCreateGroup()}\n            autoFocus\n          />\n          <div className=\"flex gap-2\">\n            <button onClick={() => setShowCreate(false)} className=\"flex-1 rounded-xl py-2.5 text-sm\"\n              style={{ background: 'var(--bg-elevated)', color: 'var(--text-secondary)' }}>取消</button>\n            <button onClick={handleCreateGroup} className=\"flex-1 rounded-xl py-2.5 text-sm font-semibold\"\n              style={{ background: 'var(--z2m-accent)', color: '#000' }}>建立</button>\n          </div>\n        </div>\n      )}\n\n      {/* Group list */}\n      <div className=\"space-y-3 px-5 pb-6\">\n        {groups.length === 0 && (\n          <div className=\"py-12 text-center text-sm\" style={{ color: 'var(--text-tertiary)' }}>\n            尚無群組，點擊 ➕ 新增\n          </div>\n        )}\n        {groups.map((group) => {\n          const aggState = getAggregateState(group.id);\n          const isOn = aggState === 'all_on' || aggState === 'mixed';\n          const memberIeees = getMemberIeees(group);\n          const memberDevices = allDevices.filter((d) => memberIeees.has(d.ieee_address));\n          const nonMemberDevices = allDevices.filter((d) => !memberIeees.has(d.ieee_address));\n          const isEditing = editingGroup === group.friendly_name;\n\n          return (\n            <div\n              key={group.id}\n              className=\"rounded-2xl border p-4 transition-all\"\n              style={{\n                background: isOn ? 'var(--z2m-accent-soft)' : 'var(--bg-card)',\n                borderColor: isOn ? 'var(--z2m-accent-border)' : 'var(--z2m-border)',\n              }}\n            >\n              {/* Group header */}\n              <div className=\"mb-2 flex items-center justify-between\">\n                <div>\n                  <div className=\"text-[15px] font-semibold\">{group.friendly_name}</div>\n                  <div className=\"text-[12px]\" style={{ color: 'var(--text-tertiary)' }}>\n                    {memberDevices.length} 個設備\n                  </div>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  {/* Edit members */}\n                  <button\n                    onClick={() => setEditingGroup(isEditing ? null : group.friendly_name)}\n                    className=\"flex h-8 w-8 items-center justify-center rounded-full\"\n                    style={{\n                      background: isEditing ? 'var(--z2m-accent)' : 'transparent',\n                      color: isEditing ? '#000' : 'var(--text-tertiary)',\n                      minHeight: 'auto', minWidth: 'auto',\n                    }}\n                  >\n                    <UserPlus size={15} />\n                  </button>\n                  {/* Toggle */}\n                  <div\n                    className=\"relative h-[24px] w-[42px] cursor-pointer rounded-full transition-colors duration-300\"\n                    style={{ background: isOn ? 'var(--z2m-accent)' : 'var(--bg-elevated)' }}\n                    onClick={() => handleToggleGroup(group.friendly_name, isOn ? 'ON' : 'OFF')}\n                  >\n                    <div\n                      className=\"absolute top-[2px] h-[20px] w-[20px] rounded-full bg-white transition-transform duration-300\"\n                      style={{ transform: isOn ? 'translateX(20px)' : 'translateX(2px)', boxShadow: '0 1px 3px rgba(0,0,0,0.3)' }}\n                    />\n                  </div>\n                  {/* Delete */}\n                  <button onClick={() => handleDeleteGroup(group.friendly_name)}\n                    className=\"flex h-8 w-8 items-center justify-center rounded-full\"\n                    style={{ color: 'var(--text-tertiary)', minHeight: 'auto', minWidth: 'auto' }}>\n                    <Trash2 size={16} />\n                  </button>\n                </div>\n              </div>\n\n              {/* Current members */}\n              {memberDevices.length > 0 && (\n                <div className=\"flex flex-wrap gap-1.5\">\n                  {memberDevices.map((d) => (\n                    <span key={d.friendly_name}\n                      className=\"flex items-center gap-1 rounded-lg px-2.5 py-1 text-[11px]\"\n                      style={{ background: 'var(--bg-elevated)', color: 'var(--text-secondary)' }}>\n                      {d.friendly_name}\n                      {isEditing && (\n                        <X size={12} className=\"cursor-pointer\" style={{ color: 'var(--z2m-red)' }}\n                          onClick={() => handleRemoveMember(group.friendly_name, d)} />\n                      )}\n                    </span>\n                  ))}\n                </div>\n              )}\n\n              {/* Add member mode */}\n              {isEditing && (\n                <div className=\"mt-3 border-t pt-3\" style={{ borderColor: 'var(--z2m-border)' }}>\n                  <div className=\"mb-2 text-[11px]\" style={{ color: 'var(--text-tertiary)' }}>點擊設備加入群組：</div>\n                  {nonMemberDevices.length > 0 ? (\n                    <div className=\"flex flex-wrap gap-1.5\">\n                      {nonMemberDevices.map((d) => (\n                        <span key={d.friendly_name}\n                          className=\"cursor-pointer rounded-lg px-2.5 py-1 text-[11px] transition-colors active:scale-[0.95]\"\n                          style={{ background: 'var(--bg-primary)', color: 'var(--text-secondary)', border: '1px dashed var(--z2m-border)' }}\n                          onClick={() => handleAddMember(group.friendly_name, d)}>\n                          + {d.friendly_name}\n                        </span>\n                      ))}\n                    </div>\n                  ) : (\n                    <span className=\"text-[11px]\" style={{ color: 'var(--text-tertiary)' }}>所有設備已加入</span>\n                  )}\n                </div>\n              )}\n            </div>\n          );\n        })}\n      </div>\n    </div>\n  );\n}\n"],"names":["useGroups","groupStore","useGroupStore","devicesById","useDeviceStore","state","deviceStates","useMemo","states","device","getAggregateState","useCallback","groupId","getAverageBrightness","controlGroup","groupName","command","deviceService","createGroup","name","deleteGroup","addMemberToGroup","deviceName","removeMemberFromGroup","GroupManagement","navigate","useNavigate","groups","s","allIds","showCreate","setShowCreate","useState","newGroupName","setNewGroupName","editingGroup","setEditingGroup","allDevices","id","d","handleCreateGroup","toast","handleDeleteGroup","handleToggleGroup","currentState","newState","handleAddMember","group","g","updatedMembers","handleRemoveMember","m","getMemberIeees","jsxs","jsx","ChevronLeft","Plus","aggState","isOn","memberIeees","memberDevices","nonMemberDevices","isEditing","UserPlus","Trash2","X"],"mappings":"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"}