{"version":3,"file":"RoomManagement-BO76f_Dn.js","sources":["../../src/pages/RoomManagement.tsx"],"sourcesContent":["import { useState } from 'react';\nimport { ChevronLeft, Plus, Trash2, X } from 'lucide-react';\nimport { useNavigate } from 'react-router-dom';\nimport { useRoomStore } from '../stores/roomStore';\nimport { useDeviceStore } from '../stores/deviceStore';\nimport type { Device } from '../types/device';\nimport { toast } from 'sonner';\n\nexport function RoomManagement() {\n  const navigate = useNavigate();\n  const rooms = useRoomStore((s) => s.rooms);\n  const deviceRoomAssignments = useRoomStore((s) => s.deviceRoomAssignments);\n  const addRoom = useRoomStore((s) => s.addRoom);\n  const assignDevice = useRoomStore((s) => s.assignDevice);\n  const unassignDevice = useRoomStore((s) => s.unassignDevice);\n  const allIds = useDeviceStore((s) => s.allIds);\n  const byId = useDeviceStore((s) => s.byId);\n\n  const [showCreate, setShowCreate] = useState(false);\n  const [newRoomName, setNewRoomName] = useState('');\n  const [assigningRoom, setAssigningRoom] = useState<string | null>(null);\n\n  const devices: Device[] = allIds\n    .map((id) => byId[id])\n    .filter((d): d is Device => !!d && d.type !== 'coordinator');\n\n  const handleAddRoom = () => {\n    if (!newRoomName.trim()) return;\n    addRoom({ id: Date.now().toString(), name: newRoomName.trim(), icon: 'home', deviceIds: [], createdAt: Date.now(), updatedAt: Date.now() });\n    toast.success(`房間「${newRoomName}」已新增`);\n    setNewRoomName('');\n    setShowCreate(false);\n  };\n\n  const deleteRoom = useRoomStore((s) => s.deleteRoom);\n\n  const handleRemoveRoom = (roomId: string, roomName: string) => {\n    if (!confirm(`確定要刪除房間「${roomName}」？`)) return;\n    deleteRoom(roomId);\n    toast.success(`房間「${roomName}」已刪除`);\n  };\n\n  const getRoomDevices = (roomId: string) =>\n    devices.filter((d) => deviceRoomAssignments[d.friendly_name] === roomId);\n\n  const getUnassignedDevices = () =>\n    devices.filter((d) => !deviceRoomAssignments[d.friendly_name]);\n\n  return (\n    <div>\n      {/* Header */}\n      <div className=\"flex items-center justify-between px-5 pb-4 pt-2\">\n        <div className=\"flex items-center gap-3\">\n          <button onClick={() => navigate('/settings')} className=\"flex h-8 w-8 items-center justify-center rounded-full\"\n            style={{ background: 'var(--bg-card)', minHeight: 'auto', minWidth: 'auto' }}>\n            <ChevronLeft size={18} />\n          </button>\n          <h1 className=\"text-[24px] font-bold\">房間管理</h1>\n        </div>\n        <button onClick={() => setShowCreate(true)}\n          className=\"flex h-10 w-10 items-center justify-center rounded-full border transition-all active:scale-[0.92]\"\n          style={{ background: 'var(--bg-card)', borderColor: 'var(--z2m-border)' }}>\n          <Plus size={18} />\n        </button>\n      </div>\n\n      {/* Create Room */}\n      {showCreate && (\n        <div className=\"mx-5 mb-4 rounded-2xl border p-4\" style={{ background: 'var(--bg-card)', borderColor: 'var(--z2m-border)' }}>\n          <div className=\"mb-3 text-sm font-medium\">新增房間</div>\n          <input type=\"text\" value={newRoomName} onChange={(e) => setNewRoomName(e.target.value)}\n            placeholder=\"房間名稱（如：客廳、臥室）\"\n            className=\"mb-3 w-full rounded-xl border px-4 py-3 text-sm\"\n            style={{ background: 'var(--bg-elevated)', borderColor: 'var(--z2m-border)', color: 'var(--text-primary)' }}\n            onKeyDown={(e) => e.key === 'Enter' && handleAddRoom()} autoFocus />\n          <div className=\"flex gap-2\">\n            <button onClick={() => setShowCreate(false)} className=\"flex-1 rounded-xl py-2.5 text-sm\"\n              style={{ background: 'var(--bg-elevated)', color: 'var(--text-secondary)' }}>取消</button>\n            <button onClick={handleAddRoom} className=\"flex-1 rounded-xl py-2.5 text-sm font-semibold\"\n              style={{ background: 'var(--z2m-accent)', color: '#000' }}>新增</button>\n          </div>\n        </div>\n      )}\n\n      {/* Room list */}\n      <div className=\"space-y-3 px-5 pb-4\">\n        {rooms.map((room) => {\n          const roomDevices = getRoomDevices(room.id);\n          return (\n            <div key={room.id} className=\"rounded-2xl border p-4\"\n              style={{ background: 'var(--bg-card)', borderColor: 'var(--z2m-border)' }}>\n              <div className=\"mb-2 flex items-center justify-between\">\n                <div>\n                  <div className=\"text-[15px] font-semibold\">{room.name}</div>\n                  <div className=\"text-[12px]\" style={{ color: 'var(--text-tertiary)' }}>{roomDevices.length} 個設備</div>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  <button onClick={() => setAssigningRoom(assigningRoom === room.id ? null : room.id)}\n                    className=\"rounded-lg px-3 py-1.5 text-[12px] font-medium\"\n                    style={{ background: assigningRoom === room.id ? 'var(--z2m-accent)' : 'var(--bg-elevated)', color: assigningRoom === room.id ? '#000' : 'var(--text-secondary)', minHeight: 'auto', minWidth: 'auto' }}>\n                    {assigningRoom === room.id ? '完成' : '分配設備'}\n                  </button>\n                  <button onClick={() => handleRemoveRoom(room.id, room.name)}\n                    className=\"flex h-8 w-8 items-center justify-center rounded-full\"\n                    style={{ color: 'var(--text-tertiary)', minHeight: 'auto', minWidth: 'auto' }}>\n                    <Trash2 size={16} />\n                  </button>\n                </div>\n              </div>\n              {/* Current devices */}\n              {roomDevices.length > 0 && (\n                <div className=\"flex flex-wrap gap-1.5\">\n                  {roomDevices.map((d) => (\n                    <span key={d.friendly_name}\n                      className=\"flex items-center gap-1 rounded-lg px-2.5 py-1 text-[11px]\"\n                      style={{ background: 'var(--bg-elevated)', color: 'var(--text-secondary)' }}>\n                      {d.friendly_name}\n                      {assigningRoom === room.id && (\n                        <X size={12} className=\"cursor-pointer\" style={{ color: 'var(--z2m-red)' }}\n                          onClick={() => unassignDevice(d.friendly_name)} />\n                      )}\n                    </span>\n                  ))}\n                </div>\n              )}\n              {/* Assign mode: show unassigned devices */}\n              {assigningRoom === room.id && (\n                <div className=\"mt-3 border-t pt-3\" style={{ borderColor: 'var(--z2m-border)' }}>\n                  <div className=\"mb-2 text-[11px]\" style={{ color: 'var(--text-tertiary)' }}>點擊設備加入此房間：</div>\n                  <div className=\"flex flex-wrap gap-1.5\">\n                    {getUnassignedDevices().map((d) => (\n                      <span key={d.friendly_name}\n                        className=\"cursor-pointer rounded-lg px-2.5 py-1 text-[11px] transition-colors\"\n                        style={{ background: 'var(--bg-primary)', color: 'var(--text-secondary)', border: '1px dashed var(--z2m-border)' }}\n                        onClick={() => { assignDevice(d.friendly_name, room.id); toast.success(`${d.friendly_name} → ${room.name}`); }}>\n                        + {d.friendly_name}\n                      </span>\n                    ))}\n                    {getUnassignedDevices().length === 0 && (\n                      <span className=\"text-[11px]\" style={{ color: 'var(--text-tertiary)' }}>所有設備已分配</span>\n                    )}\n                  </div>\n                </div>\n              )}\n            </div>\n          );\n        })}\n      </div>\n\n      {/* Unassigned devices */}\n      {getUnassignedDevices().length > 0 && (\n        <div className=\"px-5 pb-6\">\n          <div className=\"mb-2 text-[13px] font-medium\" style={{ color: 'var(--text-tertiary)' }}>\n            未分配設備（{getUnassignedDevices().length}）\n          </div>\n          <div className=\"flex flex-wrap gap-1.5\">\n            {getUnassignedDevices().map((d) => (\n              <span key={d.friendly_name} className=\"rounded-lg px-2.5 py-1 text-[11px]\"\n                style={{ background: 'var(--bg-card)', color: 'var(--text-tertiary)', border: '1px solid var(--z2m-border)' }}>\n                {d.friendly_name}\n              </span>\n            ))}\n          </div>\n        </div>\n      )}\n\n      {rooms.length === 0 && !showCreate && (\n        <div className=\"py-12 text-center text-sm\" style={{ color: 'var(--text-tertiary)' }}>\n          尚無房間，點擊 ➕ 新增\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":["RoomManagement","navigate","useNavigate","rooms","useRoomStore","s","deviceRoomAssignments","addRoom","assignDevice","unassignDevice","allIds","useDeviceStore","byId","showCreate","setShowCreate","useState","newRoomName","setNewRoomName","assigningRoom","setAssigningRoom","devices","id","d","handleAddRoom","toast","deleteRoom","handleRemoveRoom","roomId","roomName","getRoomDevices","getUnassignedDevices","jsxs","jsx","ChevronLeft","Plus","room","roomDevices","Trash2","X"],"mappings":"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"}