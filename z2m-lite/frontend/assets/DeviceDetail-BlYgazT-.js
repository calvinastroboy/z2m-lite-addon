import{j as e}from"./ui-BNQquHvV.js";import{f as C,c as k,r as b}from"./vendor-DN6e53jq.js";import{u as _,a as O,d as S,t as h}from"./index-Cd7pvFwH.js";import{e as y,f as D,b as f,I}from"./icons-Cg0FTVUT.js";import"./i18n-BzK7rx8x.js";function X(){const{deviceId:x}=C(),o=k(),j=_(t=>t.byId),{controlDevice:l}=O(),s=x?j[decodeURIComponent(x)]:void 0,[N,c]=b.useState(!1),[a,m]=b.useState("");if(!s)return e.jsxs("div",{className:"p-5",children:[e.jsxs("button",{onClick:()=>o("/"),className:"mb-4 flex items-center gap-2 text-sm",style:{color:"var(--text-secondary)",minHeight:"auto",minWidth:"auto"},children:[e.jsx(y,{size:16})," 返回"]}),e.jsx("p",{style:{color:"var(--text-tertiary)"},children:"找不到設備"})]});const i=s.lastSeen?Date.now()-s.lastSeen<5*60*1e3:s.interview_completed!==!1,r=s.state?.state==="ON",g=s.capabilities?.onOff??!1,w=s.capabilities?.brightness??!1,z=s.capabilities?.colorTemperature??!1,p=s.state?.brightness!=null?Math.round(Number(s.state.brightness)/2.54):0,d=s.capabilities?.endpoints,u=d&&d.length>1,v=async()=>{if(!(!a.trim()||a.trim()===s.friendly_name))try{await S.renameDevice(s.friendly_name,a.trim()),h.success(`已改名為「${a.trim()}」`),c(!1),o(`/device/${encodeURIComponent(a.trim())}`,{replace:!0})}catch{h.error("改名失敗")}};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between px-5 pb-4 pt-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>o("/"),className:"flex h-8 w-8 items-center justify-center rounded-full",style:{background:"var(--bg-card)",minHeight:"auto",minWidth:"auto"},children:e.jsx(y,{size:18})}),e.jsx("h1",{className:"max-w-[250px] truncate text-[20px] font-bold",children:s.friendly_name})]}),e.jsx("button",{onClick:()=>{m(s.friendly_name),c(!0)},className:"flex h-10 w-10 items-center justify-center rounded-full border transition-all active:scale-[0.92]",style:{background:"var(--bg-card)",borderColor:"var(--z2m-border)"},children:e.jsx(D,{size:16})})]}),N&&e.jsxs("div",{className:"mx-5 mb-4 rounded-2xl border p-4",style:{background:"var(--bg-card)",borderColor:"var(--z2m-border)"},children:[e.jsx("div",{className:"mb-3 text-sm font-medium",children:"設備改名"}),e.jsx("input",{type:"text",value:a,onChange:t=>m(t.target.value),className:"mb-3 w-full rounded-xl border px-4 py-3 text-sm",style:{background:"var(--bg-elevated)",borderColor:"var(--z2m-border)",color:"var(--text-primary)"},onKeyDown:t=>t.key==="Enter"&&v(),autoFocus:!0}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>c(!1),className:"flex-1 rounded-xl py-2.5 text-sm",style:{background:"var(--bg-elevated)",color:"var(--text-secondary)"},children:"取消"}),e.jsx("button",{onClick:v,className:"flex-1 rounded-xl py-2.5 text-sm font-semibold",style:{background:"var(--z2m-accent)",color:"#000"},children:"確認"})]})]}),u&&e.jsxs("div",{className:"mx-5 mb-4 rounded-2xl border p-5",style:{background:"var(--bg-card)",borderColor:"var(--z2m-border)"},children:[e.jsx("div",{className:"mb-3 text-[14px] font-semibold",children:"開關控制"}),e.jsx("div",{className:"space-y-3",children:d.map(t=>{const n=s.state?.[t.property]==="ON";return e.jsxs("div",{className:"flex items-center justify-between rounded-xl p-3",style:{background:"var(--bg-elevated)"},children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(f,{size:20,style:{color:n?"var(--z2m-accent)":"var(--text-tertiary)"}}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-[14px] font-medium",children:["開關 ",t.endpoint.toUpperCase()]}),e.jsx("div",{className:"text-[12px]",style:{color:n?"var(--z2m-accent)":"var(--text-tertiary)"},children:n?"開啟":"關閉"})]})]}),e.jsx("div",{className:"relative h-[28px] w-[50px] cursor-pointer rounded-full transition-colors duration-300",style:{background:n?"var(--z2m-accent)":"rgba(255,255,255,0.1)"},onClick:()=>l(s.friendly_name,{[t.property]:n?"OFF":"ON"}),children:e.jsx("div",{className:"absolute top-[3px] h-[22px] w-[22px] rounded-full bg-white transition-transform duration-300",style:{transform:n?"translateX(24px)":"translateX(3px)",boxShadow:"0 1px 3px rgba(0,0,0,0.3)"}})})]},t.endpoint)})})]}),g&&!u&&e.jsxs("div",{className:"mx-5 mb-4 rounded-2xl border p-5",style:{background:"var(--bg-card)",borderColor:"var(--z2m-border)"},children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(f,{size:24,style:{color:r?"var(--z2m-accent)":"var(--text-tertiary)"}}),e.jsx("span",{className:"text-lg font-semibold",children:r?"開啟":"關閉"})]}),e.jsx("div",{className:"relative h-[28px] w-[50px] cursor-pointer rounded-full transition-colors duration-300",style:{background:r?"var(--z2m-accent)":"var(--bg-elevated)"},onClick:()=>l(s.friendly_name,{state:r?"OFF":"ON"}),children:e.jsx("div",{className:"absolute top-[3px] h-[22px] w-[22px] rounded-full bg-white transition-transform duration-300",style:{transform:r?"translateX(24px)":"translateX(3px)",boxShadow:"0 1px 3px rgba(0,0,0,0.3)"}})})]}),w&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"mb-2 flex justify-between text-[13px]",children:[e.jsx("span",{style:{color:"var(--text-secondary)"},children:"亮度"}),e.jsxs("span",{style:{color:"var(--z2m-accent)"},children:[p,"%"]})]}),e.jsx("input",{type:"range",min:1,max:100,value:p,onChange:t=>l(s.friendly_name,{brightness:Math.round(Number(t.target.value)*2.54)}),className:"w-full cursor-pointer accent-amber-500",disabled:!i||!r,style:{accentColor:"var(--z2m-accent)"}})]}),z&&e.jsxs("div",{children:[e.jsxs("div",{className:"mb-2 flex justify-between text-[13px]",children:[e.jsx("span",{style:{color:"var(--text-secondary)"},children:"色溫"}),e.jsx("span",{style:{color:"var(--text-tertiary)"},children:s.state?.color_temp?`${Math.round(1e6/Number(s.state.color_temp))}K`:"—"})]}),e.jsx("input",{type:"range",min:153,max:500,value:Number(s.state?.color_temp??370),onChange:t=>l(s.friendly_name,{color_temp:Number(t.target.value)}),className:"w-full cursor-pointer",disabled:!i||!r,style:{accentColor:"var(--z2m-accent)"}}),e.jsxs("div",{className:"mt-1 flex justify-between text-[11px]",style:{color:"var(--text-tertiary)"},children:[e.jsx("span",{children:"冷光 6500K"}),e.jsx("span",{children:"暖光 2000K"})]})]})]}),e.jsxs("div",{className:"mx-5 mb-4 rounded-2xl border p-4",style:{background:"var(--bg-card)",borderColor:"var(--z2m-border)"},children:[e.jsxs("div",{className:"mb-3 flex items-center gap-2",children:[e.jsx(I,{size:16,style:{color:"var(--text-tertiary)"}}),e.jsx("span",{className:"text-[14px] font-semibold",children:"設備資訊"})]}),e.jsxs("div",{className:"space-y-2 text-[13px]",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:"var(--text-tertiary)"},children:"狀態"}),e.jsx("span",{style:{color:i?"var(--z2m-green)":"var(--z2m-red)"},children:i?"● 在線":"● 離線"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:"var(--text-tertiary)"},children:"類型"}),e.jsx("span",{children:s.type})]}),s.definition?.vendor&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:"var(--text-tertiary)"},children:"廠商"}),e.jsx("span",{children:s.definition.vendor})]}),s.definition?.model&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:"var(--text-tertiary)"},children:"型號"}),e.jsx("span",{children:s.definition.model})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:"var(--text-tertiary)"},children:"IEEE 地址"}),e.jsx("span",{className:"font-mono text-[11px]",children:s.ieee_address})]}),s.state?.linkquality!=null&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:"var(--text-tertiary)"},children:"信號品質"}),e.jsxs("span",{children:[s.state.linkquality,"/255"]})]}),s.power_source&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:"var(--text-tertiary)"},children:"供電方式"}),e.jsx("span",{children:s.power_source==="Battery"?"電池":s.power_source==="Mains (single phase)"?"市電":s.power_source})]})]})]})]})}export{X as DeviceDetail};
//# sourceMappingURL=DeviceDetail-BlYgazT-.js.map
